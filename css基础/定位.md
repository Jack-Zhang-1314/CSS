# 定位

## 定位的意义

> 1. 浮动可以让多个块级盒子一行没有缝隙排列显示,经常用于横向排列盒子
> 2. 定位则是可以让盒子自由的在某个盒子内移动位置或者固定在屏幕中某个位置,并且可以压住其他盒子

## 定位的组成

>* 定位:将盒子定在某一个位置,所以定位也是摆放盒子,按照定位的方式移动盒子.<span style="color:red">定位=定位模式+边偏移</span>
>* 定时模式用于指定元素在文档中的定位方式.边偏移则决定了该元素的最终位置

1. 定位模式:通过css的```position```属性来设定

   | 值       | 语义     |
   | -------- | -------- |
   | static   | 静态定位 |
   | relative | 相对定位 |
   | absolute | 绝对定位 |
   | fixed    | 固定定位 |

2. 边偏移:top,bottom,left,right 4个值(相对于父元素而言)

### 静态定位

* 按照标准流特性摆放,没有边偏移

### 相对定位relative

* 相对定位是元素移动的时候,相对于原来的位置来说```position:relative;```
* 特点:
   1. left/top/right/bottom是显贵与包块块计算.并且相对于子级原来的位置移动的(<span style="color:red">移动位置的时候参照点是自己原来的位置</span>)
   2. 原来在标准流的位置继续占有,后面的盒子任然以标准流的方式对待它(<span style="color:red">不脱标,继续保留原来的位置</span>)
* 尽量不使用`relative`,如果想定位某些元素,尽量使用**无依赖的绝对定位**
  * 一个元素设置成相对定位之后,其实他的层级(z-index)变高了,创建了新的层级上下文

### 绝对定位absolute

* 绝对定位是在元素移动位置的时候,相对于它祖先元素来说的```position:absoulte;```
* 特点:
   1. 如果没有祖先元素或者祖先元素没有定位,以浏览器定位为准(Document文档)
   2. 如果祖先元素有定位(相对,绝对,固定),则以最近一级的有定位祖先元素为参考点移动位置
   3. 绝对定位<span style="color:red">不再占有原来的位置</span>(脱离标准流)

> 包含块:用来计算和定位的一个框

1. 根元素(初始包含块),尺寸等同于浏览器视窗大小
2. 如果元素的position为`relative`或者`static`,则包含块有最近的块容器祖先盒的content box边界形成
3. 如果元素`position:fixed`,则包含块是初始包含快
4. 如果元素`position:absolute`,则包含快由最近的不为`static`建立

* 如果包含快是纯`inline`元素

  * 假设给内联元素的前后各生成一个宽度为0的内联盒子,则这两个内联盒子的`padding box`外面的包围盒就是内联元素的包含块

  * 当内联元素被跨行分割,包含块则由浏览器自行发挥(由于规范未定义)
  * 如果不是上述情况,则由祖先的`padding box`边界形成

> absolute的特点

1. 内联元素也可以作为“包含块”所在的元素

2. 包含块”所在的元素不是父块级元素，而是最近的 position 不为 static 的祖先 元素或根元素
3. 边界是 `padding box` 而不是 `content box`

#### absolute的无依赖性

> 实际上`absolute`在css中是非常独立的属性,不需要依赖其它css属性(例如父元素设置`position:relative`)

* 当然他的位置还是当前位置,不会是在浏览器左上方

* 本质上就是元素自身使用`absolute`,然后通过`margin`进行移动
* `position:absolute`给i有的display的计算值都是`block`(使元素块状化),但是其定位的位置和没有设置`position:absolute`时候的位置相关

#### overflow与absolute

> 如果`overflow`不是定位元素,同时绝对定位元素和`overflow`容器之间也没有定位元素,则`overflow`无法对absolute元素进行裁剪

* overflow元素可以裁减的情况
  1. `overflow`属性所在的元素同时也是定位元素,里面的绝对定位元素会被裁剪
  2. `overflow`元素和绝对定位元素之间也有定位元素,也会被裁剪
* 注意:由于`position:fixed`固定定位元素的包含块是根元素,因此除非是窗体滚动,否则上面所有的规则都不适用
* `transform`也会改变裁剪的规则

#### absolute 与 clip

> 裁剪属性(clip)只有当元素position是absolute或者是fixed是才会起作用

* 由于`position:fixed`属性使用overflow往往不会出现明显的效果,这时候就可以选择clip进行裁剪

* 可访问隐藏性的方式
  1. 下策:`display:none`或者`visibitity:hidden`,屏幕阅读设备会忽略这里的文字
  2. 移动端上策:`color:transparent`
  3. 上策:`clip`,完全支持,并且是视觉上的隐藏.并且不会有页面跳动的视觉问题
* clip决定订了哪一部分是隐藏的,对原来占据的空间并无影响.并且使用clip进行裁剪的元素`clientWidth`和`clientHeight`包括样式计算的宽高都是原来的大小

#### absolute的流体特性

> 当absolute中有定位元素才会整整的变成绝对定位

* 当`left`和`right`同时存在的时候,宽度就不会是0,而是表现为**格式化宽度**,大小自适应包含块的`padding box`

```css
.box{
    position:absolute;
    left:0;right:0;
}
```

#### 父元素设置`position:relative`

1. 子级绝对定位,不会占有位置,可以放到父盒子里面的任何一个地方,不会影响其它的兄弟盒子
2. 父盒子需要加定位限制子盒子在父盒子内显示
3. 父盒子布局时,需要占有位置,因此父亲只能是相对定位

### 固定定位(fixed)

* 固定定位`position:fixed;`的包含块是根元素(<html>)
* 和无依赖的绝对定位类型,**无依赖的固定定位**利用absolute/fixed元素没有设置left/right/top/bottom的相对定位的特点,将元素定位到想要的位置
* 特点:
   1. 以浏览器的可是窗口为参照点移动元素.
      * 跟父元素没有任何关系
      * 不随滚动条移动
   2. 固定定位<span style="color:red">不再占有原先的位置</span>
      * 固定定位也是脱标的,其实固定定位也可以看作是一种特殊的绝对定位

### 粘性定位(sticky)

* 粘性定位可以被认为是相对定位和固定定位的混合`position:sticky;`

> 粘性定位与相对定位相似的地方

1. 元素发生偏移的时候,元素的原始位置保留
2. 创建了新的绝对定位包含快.如果粘性定位的子元素设置left,right等方位属性是相对于当前粘性定位元素的
3. 支持设置`z-index`的属性值来改变元素的层叠顺序

> 粘性定位与相对定位不一样的地方

1. 偏移计算元素不一样.相对定位偏移甲酸的是父容器.<span style="color:red">粘性定位偏移计算的元素是层级最近的可滚动元素(overflow不是visible的元素)</span>.如果没有,则相对视口滚动
2. 偏移定位计算规则不一样
3. 重叠表现不一样.相对元素彼此独立,重叠的表现为堆叠.而粘性定位重叠的时候会表现A粘性定位推开B粘性定位元素的表现

```css
html,body {
  height: 200%;
}
nav {
  width: 100px;
  height: 100px;
  background-color: black;
  position: sticky;
  top: 0;
}
```

#### 可滚动元素对粘性定位的影响

* 如果粘性定位元素的某个祖先元素的overflow属性值不是visible,那么窗体滚动就不会有粘性定位效果
  * 因为此时的<nav>元素的粘性定位偏移计算是相对于父元素<div>的

```html
<style>
  div{
  overflow:hidden;
}

nav{  
  position:sticky;
  top:0;
}
</style>
<div>
  <nav></nav>
</div>
```

<iframe height="300" style="width: 100%;" scrolling="no" title="Untitled" src="https://codepen.io/jack-zhang-1314/embed/oNwzPaZ?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href="https://codepen.io/jack-zhang-1314/pen/oNwzPaZ">
  Untitled</a> by Jack-Zhang-1314 (<a href="https://codepen.io/jack-zhang-1314">@jack-zhang-1314</a>)
  on <a href="https://codepen.io">CodePen</a>.
</iframe>

* 因此当网页希望是窗体滚动又是粘性效果,那么必须保证定位元素的祖先元素没有可滚动效果

#### 粘性定位的计算规则

>粘性定位的中有一个`流盒(flow box)`的概念,指的是粘性定位元素最近可滚动的元素的尺寸盒子

* **粘性约束矩形**:粘性定位元素(通常是父元素),在文档流中呈现的矩形区域<span style="color:red">和流盒的4个边缘在应用粘性定位元素的left,top,right,bottom偏移计算值后的新矩形的交集</span>
* 由于滚动的时候流盒不变,而粘性定位元素包含块滚动,**因此粘性约束矩形随着滚动的进行是实时变化的**
* 粘性约束矩形是流盒矩形和包含快的重叠区域

#### 粘性定位的堆叠规则

>当粘性定位元素分布在不同容器的时候,就会有很多不同的粘性约束矩形,这些粘性约束矩形排列很整齐,于是在视觉上表现为上一个粘性定位元素被滚动走,下一个粘性定位呀u盛怒刚开始有粘性效果

* 当粘性定位都在一个容器里是,大家都共用一个巨大的一个巨大的粘性约束矩形,因此滚动元素会一个个不停的往上重叠

#### 粘性定位的运用:层次滚动

<iframe height="300" style="width: 100%;" scrolling="no" title="层次滚动" src="https://codepen.io/jack-zhang-1314/embed/QWOoPqr?default-tab=html%2Cresult" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href="https://codepen.io/jack-zhang-1314/pen/QWOoPqr">
  层次滚动</a> by Jack-Zhang-1314 (<a href="https://codepen.io/jack-zhang-1314">@jack-zhang-1314</a>)
  on <a href="https://codepen.io">CodePen</a>.
</iframe>

1. 为表情图和网友评论元素都设置粘性定位,往右评论元素同时设置`z-index=-1`,将其藏在内容后面
2. 每一段的标题和网友评论都使用一个<section>元素包起 来，让黏性定位元素隶属于不同的容器元素，这样就实现了依次置顶占位的效果

### 定位的特殊性

1. 行内元素添加绝对或者固定定位,可以直接设置高度和宽度
2. 块级元素添加绝对或者固定定位,如果不给宽度或者高度,默认是内容的大小
3. 绝对定位(固定定位)会完全压住盒子.浮动元素不会,只会眼珠它下面的标准流盒子,但是不会压住标准流盒子里面的文字,<span style="color:red">浮动可以做文字环绕效果.</span>
